---
title: 渗透测试-公司内网
date: 2018-06-28 08:43:04
tags:
  - 渗透测试
  - 内网
categories: 渗透测试
---

## 0x01 问题发现
前段时间在公司内网搭建了OSSIM，对公司10.10.66.1/24网段进行扫描，发现10.10.66.239存在严重漏洞，如下图：
![](2018-06-28-域渗透-公司内网\漏洞.PNG)
<!--more-->
## 0x02 漏洞利用
直接打开kali中神器msf，里面已经有ms17-010的poc，利用后获取meterpreter，如下图：
![](2018-06-28-域渗透-公司内网\meterpreter.PNG)

查看权限，直接为system权限。

![](2018-06-28-域渗透-公司内网\getuid.PNG)

其他查看信息的命令不一一列举。

进入cmd，发现kali控制台显示乱码，使用chcp 65001命令解决：

![](2018-06-28-域渗透-公司内网\乱码.PNG)

查看systeminfo信息，发现是域控。。。。。

![](2018-06-28-域渗透-公司内网\域控.PNG)

## 0x02 域信息收集
windows server机器，使用dsget和dsquery进行域信息收集。
使用命令查看全域信息，内容太多，就不截图了
```cmd
dsquery * -limit 0 -attr *
```
***
CN, OU, DC 都是 LDAP 连接服务器的端字符串中的区别名称（DN, distinguished   name）

    DC (Domain Component)
    CN (Common Name)
    OU (Organizational Unit)

例如：CN=test,OU=developer,DC=domainname,DC=com

在上面的代码中 cn=test 可能代表一个用户名，ou=developer 代表一个 active directory 中的组织单位。这句话的含义可能就是说明 test 这个对象处在domainname.com 域的 developer 组织单元中
***

查看域控制器，这里已经是域控制器，就不查看了。域控制器命令
```cmd
dsquery server -limit 0 | dsget server -dn -desc -dnsname -site -isgc
```
其dsquery和dsget命令不一一列举。

使用net查看命令查看域信息。
net group /do

![](2018-06-28-域渗透-公司内网\net_group.PNG)

查看Domain Admins组成员，使用dsquery同样可以查询。
net group "Domain Admins" /do

![](2018-06-28-域渗透-公司内网\Domain_Admins.PNG)

在上面，我们使用net view查看信息时报错：
```cmd
System error 6118 has occurred.

The list of servers for this workgroup is not currently available
```
需要从services.msc中打开Computer Browser，先将域管理员用户打开。

## 0x03 后记
公司内网，就不使用mimikatz进行获取密码了。下班了，其他情况日后再说。
黄金票据，白银票据等内容可以查看此博客：
[域渗透相关](https://1sparrow.com/2018/02/19/%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9B%B8%E5%85%B3/)
